# ניתוח שינויים: מעבר למבנה חדש

## מה משתנה, מה נמחק, מה מתווסף

**תאריך:** 2025-01-XX  
**גרסה:** 2.1.0  
**סטטוס:** ממתין לאישור

---

## 📋 תוכן עניינים

1. [המצב הנוכחי](#1-המצב-הנוכחי)
2. [מה משתנה](#2-מה-משתנה)
3. [מה נמחק](#3-מה-נמחק)
4. [מה מתווסף](#4-מה-מתווסף)
5. [UI/UX מפורט - עורך המפה](#5-uiux-מפורט---עורך-המפה)
6. [מודולים חדשים (שלד)](#6-מודולים-חדשים-שלד)
7. [התוצאה הסופית](#7-התוצאה-הסופית)

---

## 1. המצב הנוכחי

### היררכיית הניווט הנוכחית:

```
/venues/[venueId]/
├── map/              # עורך מפה (venue-map)
├── lines/            # ליינים
├── roles/            # תפקידים והיררכיה
├── info/             # פרטי מקום
├── calendar/         # לוח שנה
└── reservations/     # הזמנות
```

### מבנה venue-map הנוכחי:

```
Venue
├── Zone[] (קשור ישירות ל-Venue)
│   └── Table[]
└── VenueArea[] (קשור ישירות ל-Venue)
```

**בעיות במצב הנוכחי:**

- ❌ אין מושג "מפה" (FloorPlan)
- ❌ אין אפשרות למפות מרובות
- ❌ אין קשר בין Line למפה
- ❌ UI מסובך מדי

---

## 2. מה משתנה

### 2.1 היררכיית הניווט

**מ:**

```
/venues/[venueId]/
├── map/
├── lines/
├── roles/
├── info/
└── settings/
```

**ל:**

```
/venues/[venueId]/
│
├── lines/                    # מחוץ ל-Settings
├── roles/                    # מחוץ ל-Settings
├── info/                     # מחוץ ל-Settings
├── menus/                    # מחוץ ל-Settings (➕ חדש)
│
└── settings/
    ├── structure/            # מפות
    ├── reservations/         # הגדרות הזמנות
    ├── tickets/              # הגדרת כרטיסים (➕ שלד)
    ├── inventory/            # ניהול מלאי (➕ שלד)
    └── team/                 # ניהול צוותים ויחצנים (➕ שלד)
```

### 2.2 מודל הנתונים

**מ:** Zone/Table קשור ישירות ל-Venue  
**ל:** Zone/Table קשור ל-FloorPlan

---

## 3. מה נמחק

❌ **`/venues/[venueId]/map/`** - מוחלף ב-`/settings/structure/`  
❌ **`FloorPlanEditorV2.tsx`** - קובץ ענק (6490 שורות)  
❌ **Zone.venueId / VenueArea.venueId** - יוחלף ב-floorPlanId

---

## 4. מה מתווסף

### 4.1 מודל FloorPlan (חדש)

```prisma
model FloorPlan {
  id          String   @id
  venueId     String
  name        String
  isDefault   Boolean  @default(false)
  isLocked    Boolean  @default(false)

  zones       Zone[]
  venueAreas  VenueArea[]
  lines       Line[]           // many-to-many
  events      LineOccurrence[] // מפה מותאמת לאירוע
}
```

### 4.2 קשר FloorPlan ← Lines

- מפה יכולה להיות משויכת לליין אחד או יותר
- ניתן ליצור מפה ספציפית לאירוע בודד

### 4.3 מודול Menus (חדש)

- ממשק יפה כמו עורך המפה
- יצירת תפריטים עם פריטים
- קישור **אופציונלי** לליין אחד או יותר

---

## 5. UI/UX מפורט - עורך המפה

### 5.1 עיקרון מנחה

> **"כל ילד יכול לשחק עם זה בקלילות וגם כל קשיש"**

- אינטראקציה פשוטה ביותר
- מינימום כפתורים
- הנחיות ויזואליות ברורות
- אנימציות מרגיעות
- פידבק מיידי

---

### 5.2 מסך יצירת מפה חדשה

#### שלב 1: בחירת צורת המקום

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│     🏠 איזה סוג מקום יש לך?                        │
│                                                     │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐│
│  │   ▭    │  │   ▢    │  │   L    │  │   ?    ││
│  │ מלבן   │  │ ריבוע  │  │  צורת L │  │ מותאם  ││
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘│
│                                                     │
│           (לחיצה → עוברים לשלב הבא)                 │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### שלב 2: הגדרת גודל בסיסי (Slider פשוט)

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│     📐 כמה גדול המקום?                             │
│                                                     │
│     קטן ●─────────────────●───────────────● גדול   │
│              [התצוגה משתנה בזמן אמת]                │
│                                                     │
│     ┌───────────────────────────────────┐           │
│     │                                   │           │
│     │      [ תצוגה מקדימה של המפה ]     │           │
│     │                                   │           │
│     └───────────────────────────────────┘           │
│                                                     │
│                        [המשך →]                     │
└─────────────────────────────────────────────────────┘
```

#### שלב 3: הוספת איזורים (Drag & Drop קל)

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│  גרור איזורים למפה:                                │
│                                                     │
│  ┌────────────────┐   ┌─────────────────────────┐  │
│  │                │   │                         │  │
│  │ 🪑 אזור ישיבה │   │                         │  │
│  │                │   │   [מפה אינטראקטיבית]   │  │
│  │ 🍸 בר         │   │                         │  │
│  │                │   │   גרור לכאן ←          │  │
│  │ 🚻 שירותים   │   │                         │  │
│  │                │   │                         │  │
│  │ 🚪 כניסה     │   │                         │  │
│  │                │   └─────────────────────────┘  │
│  │ ⭐ VIP       │                                  │
│  │                │   טיפ: לחץ על אזור לשינוי גודל │
│  └────────────────┘                                │
│                                                     │
│                        [סיימתי ✓]                  │
└─────────────────────────────────────────────────────┘
```

#### שלב 4: הוספת שולחנות (Auto-fill חכם)

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│  כמה שולחנות בכל איזור?                            │
│                                                     │
│  ┌──────────────────────────────────────────────┐  │
│  │ 🟦 איזור מרכזי                               │  │
│  │                                              │  │
│  │   כמות: [ - ] 8 [ + ]    מושבים: [ - ] 4 [ + ]│ │
│  │                                              │  │
│  │   [✓ מלא אוטומטי] [○ ידני]                   │  │
│  └──────────────────────────────────────────────┘  │
│                                                     │
│  ┌──────────────────────────────────────────────┐  │
│  │ 🟨 איזור VIP                                 │  │
│  │                                              │  │
│  │   כמות: [ - ] 4 [ + ]    מושבים: [ - ] 6 [ + ]│ │
│  │                                              │  │
│  │   [✓ מלא אוטומטי] [○ ידני]                   │  │
│  └──────────────────────────────────────────────┘  │
│                                                     │
│    [תצוגה מקדימה עם השולחנות מתמלאים בזמן אמת]    │
│                                                     │
│                      [סיימתי ✓]                    │
└─────────────────────────────────────────────────────┘
```

#### שלב 5: סיום ושמירה

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│     🎉 המפה מוכנה!                                 │
│                                                     │
│     ┌───────────────────────────────────┐           │
│     │                                   │           │
│     │   [תצוגת המפה הסופית - אנימציה]  │           │
│     │                                   │           │
│     └───────────────────────────────────┘           │
│                                                     │
│     שם המפה: [________________]                     │
│                                                     │
│     קשר לליינים (אופציונלי):                       │
│     ☑ ערב רגיל   ☑ צהריים   ☐ אירועים              │
│                                                     │
│              [💾 שמור והמשך]                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

### 5.3 מסך צפייה במפה (View Mode)

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📍 מפת המקום: "ערב רגיל"                           [✏️ ערוך]      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────────────────┐  ┌─────────────────────────┐ │
│  │                                  │  │                         │ │
│  │                                  │  │  📊 סיכום               │ │
│  │                                  │  │                         │ │
│  │      [תצוגת המפה - Read Only]   │  │  איזורים: 4             │ │
│  │                                  │  │  שולחנות: 24            │ │
│  │                                  │  │  מושבים: 96             │ │
│  │                                  │  │  ברים: 1                │ │
│  │                                  │  │                         │ │
│  └──────────────────────────────────┘  ├─────────────────────────┤ │
│                                        │                         │ │
│                                        │  🔍 סינון תצוגה         │ │
│                                        │                         │ │
│                                        │  [✓] איזורים            │ │
│                                        │  [✓] שולחנות            │ │
│                                        │  [✓] ברים               │ │
│                                        │  [ ] אזורים מיוחדים     │ │
│                                        │                         │ │
│                                        ├─────────────────────────┤ │
│                                        │                         │ │
│                                        │  📋 רשימה               │ │
│                                        │                         │ │
│                                        │  ▼ איזור מרכזי (8)      │ │
│                                        │    • שולחן 1 (4 מושבים) │ │
│                                        │    • שולחן 2 (4 מושבים) │ │
│                                        │    ...                  │ │
│                                        │  ▼ איזור VIP (4)        │ │
│                                        │    • שולחן V1 (6)       │ │
│                                        │    ...                  │ │
│                                        │                         │ │
│                                        └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

**פעולות ב-View Mode:**

- **לחיצה על אלמנט במפה** → הסיידבר מראה פרטים שלו
- **לחיצה על פריט בסיידבר** → המפה מדגישה את האלמנט
- **סינון** → מסתיר/מציג סוגי אלמנטים

---

### 5.4 מסך עריכת תכולה (Content Mode)

> **נכנסים לכאן בלחיצה על "עריכה" מ-View Mode**

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📝 עריכת תכולה: "מפה ערב רגיל"               [← חזרה] [💾 שמור]   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────────────────┐  ┌─────────────────────────┐ │
│  │                                  │  │                         │ │
│  │                                  │  │  ✏️ עריכת אלמנט        │ │
│  │   [המפה - לחיצה על אלמנט         │  │                         │ │
│  │    פותחת עריכה בסיידבר]          │  │  🟦 איזור מרכזי         │ │
│  │                                  │  │  ─────────────────────  │ │
│  │   [אלמנט נבחר מודגש בזוהר]       │  │                         │ │
│  │                                  │  │  שם: [איזור מרכזי____]  │ │
│  │                                  │  │                         │ │
│  └──────────────────────────────────┘  │  מספר איזור: [_1_]      │ │
│                                        │                         │ │
│                                        │  כמות שולחנות: 8        │ │
│                                        │                         │ │
│                                        │  מספור שולחנות:         │ │
│                                        │  [✓] אוטומטי (1-8)      │ │
│                                        │  [ ] ידני               │ │
│                                        │                         │ │
│                                        │  ─────────────────────  │ │
│                                        │                         │ │
│                                        │  שולחנות באיזור:        │ │
│                                        │  ┌─────────────────────┐│ │
│                                        │  │ #1  4 מושבים   [✎] ││ │
│                                        │  │ #2  4 מושבים   [✎] ││ │
│                                        │  │ #3  4 מושבים   [✎] ││ │
│                                        │  │ ...                 ││ │
│                                        │  └─────────────────────┘│ │
│                                        │                         │ │
│                                        │      [החל על כולם]      │ │
│                                        └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

**אינטראקציה:**

- לחיצה על אלמנט במפה → פותח עריכה בסיידבר
- לחיצה על פריט ברשימה → מדגיש במפה ופותח עריכה
- כל שינוי → תצוגה מקדימה מיידית במפה

---

### 5.5 מסך סידור עבודה (Staffing Mode)

> **הכנה למשמרות בפועל - מגדיר כמה עובדים צריך בכל מקום**

```
┌─────────────────────────────────────────────────────────────────────┐
│ 👥 סידור עבודה: "מפה ערב רגיל"               [← חזרה] [💾 שמור]   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────────────────┐  ┌─────────────────────────┐ │
│  │                                  │  │                         │ │
│  │   [המפה עם אייקוני עובדים        │  │  👥 הגדרת צוות לאיזור   │ │
│  │    על כל אלמנט]                  │  │                         │ │
│  │                                  │  │  🟦 איזור מרכזי         │ │
│  │   🟦 מרכזי     🟨 VIP            │  │  ─────────────────────  │ │
│  │   👤👤          👤👤👤           │  │                         │ │
│  │                                  │  │  תפקידים נדרשים:       │ │
│  │   🍸 בר                          │  │                         │ │
│  │   👤👤                           │  │  ┌─────────────────────┐│ │
│  │                                  │  │  │ מלצר      [−] 2 [+]││ │
│  └──────────────────────────────────┘  │  │ מארח      [−] 1 [+]││ │
│                                        │  │ ברמן      [−] 0 [+]││ │
│                                        │  │ מנהל      [−] 0 [+]││ │
│                                        │  └─────────────────────┘│ │
│                                        │                         │ │
│                                        │  סה"כ לאיזור: 3 עובדים  │ │
│                                        │                         │ │
│                                        │  ─────────────────────  │ │
│                                        │                         │ │
│                                        │  📊 סיכום כללי:         │ │
│                                        │  • מלצרים: 6            │ │
│                                        │  • מארחים: 2            │ │
│                                        │  • ברמנים: 2            │ │
│                                        │  ──────────             │ │
│                                        │  סה"כ: 10 עובדים        │ │
│                                        │                         │ │
│                                        └─────────────────────────┘ │
│                                                                     │
│  💡 טיפ: זה ישמש בסיס למשמרות בפועל בלוח השנה                      │
└─────────────────────────────────────────────────────────────────────┘
```

**חיבור למשמרות:**

- ההגדרות כאן = **דיפולט** למשמרות
- כשיוצרים משמרת → מקבלים את ההגדרות האלה כבסיס
- ניתן לשנות למשמרת ספציפית

---

### 5.6 מסך מינימום הזמנה (Minimum Order Mode)

```
┌─────────────────────────────────────────────────────────────────────┐
│ 💰 מינימום הזמנה: "מפה ערב רגיל"             [← חזרה] [💾 שמור]   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────────────────┐  ┌─────────────────────────┐ │
│  │                                  │  │                         │ │
│  │   [המפה עם תגיות מחיר           │  │  💰 מינימום לאיזור      │ │
│  │    על כל אזור/שולחן]            │  │                         │ │
│  │                                  │  │  🟦 איזור מרכזי         │ │
│  │   🟦 מרכזי     🟨 VIP            │  │  ─────────────────────  │ │
│  │   ₪200         ₪500             │  │                         │ │
│  │                                  │  │  מינימום לאיזור:       │ │
│  │                                  │  │  [₪________200_______]  │ │
│  │                                  │  │                         │ │
│  └──────────────────────────────────┘  │  [ ] החל על כל שולחן   │ │
│                                        │  [✓] שונה לפי שולחן     │ │
│                                        │                         │ │
│                                        │  שולחנות:               │ │
│                                        │  ┌─────────────────────┐│ │
│                                        │  │ #1-4   ₪200 (ברירה) ││ │
│                                        │  │ #5-6   ₪250         ││ │
│                                        │  │ #7-8   ₪300         ││ │
│                                        │  └─────────────────────┘│ │
│                                        │                         │ │
│                                        │  ─────────────────────  │ │
│                                        │                         │ │
│                                        │  💡 Override לפי Line:  │ │
│                                        │  [ ] ערב רגיל: כמו פה   │ │
│                                        │  [✓] סופ"ש: ₪350       │ │
│                                        │                         │ │
│                                        └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 5.7 סיכום מצבי עריכה

| מצב          | מטרה          | מה רואים בסיידבר       |
| ------------ | ------------- | ---------------------- |
| **View**     | צפייה בלבד    | סיכום + רשימה + סינון  |
| **Content**  | עריכת תכולה   | שם, מספור, כמויות      |
| **Staffing** | סידור עבודה   | תפקידים נדרשים + סיכום |
| **Minimum**  | מינימום הזמנה | מחירים + Overrides     |

**מעבר בין מצבים:**

```
┌─────────────────────────────────────────────────┐
│  📋 Content  │  👥 Staffing  │  💰 Minimum     │
│──────────────┼───────────────┼─────────────────│
│   [נבחר]     │               │                 │
└─────────────────────────────────────────────────┘
```

---

## 6. מודולים חדשים (שלד)

### 6.1 הגדרת כרטיסים (Tickets)

> **מיקום:** `/settings/tickets/`  
> **סטטוס:** שלד בלבד - לא מימוש

```
src/modules/tickets/
├── ui/
│   └── TicketsPage.tsx      # "בקרוב - הגדרת כרטיסים"
├── types/
│   └── index.ts
└── README.md
```

**דף placeholder:**

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│              🎫 הגדרת כרטיסים                       │
│                                                     │
│              בקרוב...                               │
│                                                     │
│     מודול זה יאפשר הגדרת כרטיסים לאירועים         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 6.2 ניהול מלאי (Inventory)

> **מיקום:** `/settings/inventory/`  
> **סטטוס:** שלד בלבד - לא מימוש

```
src/modules/inventory/
├── ui/
│   └── InventoryPage.tsx    # "בקרוב - ניהול מלאי"
├── types/
│   └── index.ts
└── README.md
```

**דף placeholder:**

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│              📦 ניהול מלאי                          │
│                                                     │
│              בקרוב...                               │
│                                                     │
│     מודול זה יאפשר ניהול מלאי ומוצרים              │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 6.3 ניהול צוותים ויחצנים (Team & PR)

> **מיקום:** `/settings/team/`  
> **סטטוס:** שלד בלבד - לא מימוש

```
src/modules/team-management/
├── ui/
│   └── TeamManagementPage.tsx    # "בקרוב - ניהול צוותים"
├── types/
│   └── index.ts
└── README.md
```

**דף placeholder:**

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│              👥 ניהול צוותים ויחצנים                │
│                                                     │
│              בקרוב...                               │
│                                                     │
│     מודול זה יאפשר ניהול צוותים, יחצנים ועובדים   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 7. התוצאה הסופית

### 7.1 מבנה הניווט הסופי

```
/venues/[venueId]/
│
│  ┌─────────────────────────────────────┐
│  │     מעל הגדרת המקום (עצמאיים)      │
│  └─────────────────────────────────────┘
│
├── lines/                        # ליינים
├── roles/                        # תפקידים והיררכיה
├── info/                         # פרטי מקום
├── menus/                        # תפריטים (➕ חדש)
│
│  ┌─────────────────────────────────────┐
│  │          הגדרת המקום               │
│  └─────────────────────────────────────┘
│
└── settings/
    │
    ├── structure/                # מפות (Floor Plans)
    │   ├── (list)               # רשימת מפות
    │   └── [floorPlanId]/       # עורך מפה בודדת
    │       ├── (view)           # צפייה
    │       ├── content/         # עריכת תכולה
    │       ├── staffing/        # סידור עבודה (→ הכנה למשמרות)
    │       └── minimum-order/   # מינימום הזמנה
    │
    ├── reservations/            # הגדרות הזמנות (נשאר)
    ├── tickets/                 # 🆕 הגדרת כרטיסים (שלד)
    ├── inventory/               # 🆕 ניהול מלאי (שלד)
    └── team/                    # 🆕 ניהול צוותים ויחצנים (שלד)
│
├── calendar/                    # לוח שנה
└── events/                      # אירועים
```

### 7.2 סיכום השינויים

| סוג           | פרט                                            |
| ------------- | ---------------------------------------------- |
| **🔄 משתנה**  | Lines, Roles, Venue Info → עוברים מעל Settings |
| **🔄 משתנה**  | Zone, Table → קשורים ל-FloorPlan               |
| **❌ נמחק**   | `/map/` route → מוחלף ב-`/settings/structure/` |
| **❌ נמחק**   | FloorPlanEditorV2.tsx → קובץ ענק               |
| **➕ מתווסף** | FloorPlan model                                |
| **➕ מתווסף** | Menus module                                   |
| **➕ מתווסף** | UI/UX חדש לעורך מפות (פשוט ואינטואיטיבי)       |
| **➕ מתווסף** | Staffing → הכנה למשמרות                        |
| **🆕 שלד**    | Tickets module (הגדרת כרטיסים)                 |
| **🆕 שלד**    | Inventory module (ניהול מלאי)                  |
| **🆕 שלד**    | Team Management module (צוותים ויחצנים)        |
| **✅ נשאר**   | Reservation Settings                           |

### 7.3 עקרונות UI/UX

| עיקרון            | יישום                          |
| ----------------- | ------------------------------ |
| **פשטות**         | Wizard ליצירה, מינימום כפתורים |
| **אינטואיטיביות** | Drag & Drop, Auto-fill חכם     |
| **פידבק מיידי**   | תצוגה מקדימה בזמן אמת          |
| **נגישות**        | גדלים ברורים, אנימציות מרגיעות |
| **סינון**         | בחירה מה לראות בכל רגע         |
| **עריכה ממוקדת**  | כל מצב עריכה ספציפי למטרה שלו  |

---

**ממתין לאישור**
